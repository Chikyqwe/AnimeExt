<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Prueba API Fire</title>
<style>
    body { font-family: Arial; margin: 20px; }
    form { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; }
    label { display: block; margin: 10px 0; }
    input, textarea { width: 100%; padding: 5px; }
    pre { background: #eee; padding: 10px; }
</style>
</head>
<body>

<h2>Obtener UUID</h2>

<form id="uuidForm">
    <label>Token:
        <input type="text" id="token" required>
    </label>
    <label>Timestamp:
        <input type="text" id="timestamp" required>
    </label>
    <button type="submit">Enviar</button>
</form>

<pre id="uuidResult"></pre>

<hr>

<h2>Registrar Anime</h2>

<form id="registerForm">
    <label>UUID:
        <input type="text" id="uuidRegister" required>
    </label>

    <h3>Animes</h3>
    <div id="animeItems"></div>

    <button type="button" onclick="addAnimeItem()">Agregar Anime</button>
    <button type="submit">Enviar</button>
</form>

<pre id="registerResult"></pre>

<hr>

<h2>Obtener Animes</h2>

<form id="getAnimesForm">
    <label>UUID:
        <input type="text" id="uuidGet" required>
    </label>
    <button type="submit">Enviar</button>
</form>

<pre id="getAnimesResult"></pre>

<script>
const API_BASE = "http://localhost:2022/fire";

// ============ GET UUID ============
document.getElementById("uuidForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const token = document.getElementById("token").value;
    const timestamp = document.getElementById("timestamp").value;

    const res = await fetch(`${API_BASE}/getUUID`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ parameters: { token, timestamp } })
    });

    const data = await res.json();
    document.getElementById("uuidResult").textContent =
        JSON.stringify(data, null, 2);
});


// ============ REGISTRAR ANIME ============

// Crear item de anime (UID + EP)
function addAnimeItem(uid = "", ep = "") {
    const box = document.getElementById("animeItems");

    const div = document.createElement("div");
    div.style.border = "1px solid #aaa";
    div.style.padding = "10px";
    div.style.margin = "10px 0";

    div.innerHTML = `
        <label>UID:
            <input type="text" class="uid" value="${uid}" required>
        </label>
        <label>Episodio:
            <input type="number" class="ep" value="${ep}" required>
        </label>
        <button type="button" onclick="this.parentElement.remove()">Eliminar</button>
    `;

    box.appendChild(div);
}

// Agregar un item por defecto
addAnimeItem();

// Registrar anime -> POST /registeranime
document.getElementById("registerForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const uuid = document.getElementById("uuidRegister").value;

    const items = [...document.querySelectorAll("#animeItems > div")];
    const uids = items.map(div => ({
        uid: div.querySelector(".uid").value,
        ep: Number(div.querySelector(".ep").value)
    }));

    const res = await fetch(`${API_BASE}/registeranime`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ parameters: { uuid, uids } })
    });

    const data = await res.json();
    document.getElementById("registerResult").textContent =
        JSON.stringify(data, null, 2);
});


// ============ OBTENER ANIMES ============
document.getElementById("getAnimesForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const uuid = document.getElementById("uuidGet").value;

    const res = await fetch(`${API_BASE}/getanimes`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ parameters: { uuid } })
    });

    const data = await res.json();
    document.getElementById("getAnimesResult").textContent =
        JSON.stringify(data, null, 2);
});
</script>

</body>
</html>
